(function(){var V=this,b=V.Backbone,a=Array.prototype.slice,Q=Array.prototype.splice,Y;Y="undefined"!==typeof exports?exports:V.Backbone={};Y.VERSION="0.9.2";var Z=V._;!Z&&"undefined"!==typeof require&&(Z=require("underscore"));var X=V.jQuery||V.Zepto||V.ender;Y.setDomLibrary=function(f){X=f};Y.noConflict=function(){V.Backbone=b;return this};Y.emulateHTTP=!1;Y.emulateJSON=!1;var R=/\s+/,W=Y.Events={on:function(k,i,r){var p,o,n,m,l;if(!i){return this}k=k.split(R);for(p=this._callbacks||(this._callbacks={});o=k.shift();){n=(l=p[o])?l.tail:{},n.next=m={},n.context=r,n.callback=i,p[o]={tail:m,next:l?l.next:n}}return this},off:function(r,p,o){var n,m,k,l,i,f;if(m=this._callbacks){if(!r&&!p&&!o){return delete this._callbacks,this}for(r=r?r.split(R):Z.keys(m);n=r.shift();){if(k=m[n],delete m[n],k&&(p||o)){for(l=k.tail;(k=k.next)!==l;){if(i=k.callback,f=k.context,p&&i!==p||o&&f!==o){this.on(n,i,f)}}}}return this}},trigger:function(k){var i,p,o,n,m,l;if(!(o=this._callbacks)){return this}m=o.all;k=k.split(R);for(l=a.call(arguments,1);i=k.shift();){if(p=o[i]){for(n=p.tail;(p=p.next)!==n;){p.callback.apply(p.context||this,l)}}if(p=m){n=p.tail;for(i=[i].concat(l);(p=p.next)!==n;){p.callback.apply(p.context||this,i)}}}return this}};W.bind=W.on;W.unbind=W.off;var S=Y.Model=function(g,f){var i;g||(g={});f&&f.parse&&(g=this.parse(g));if(i=T(this,"defaults")){g=Z.extend({},i,g)}f&&f.collection&&(this.collection=f.collection);this.attributes={};this._escapedAttributes={};this.cid=Z.uniqueId("c");this.changed={};this._silent={};this._pending={};this.set(g,{silent:!0});this.changed={};this._silent={};this._pending={};this._previousAttributes=Z.clone(this.attributes);this.initialize.apply(this,arguments)};Z.extend(S.prototype,W,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return Z.clone(this.attributes)},get:function(f){return this.attributes[f]},escape:function(g){var f;if(f=this._escapedAttributes[g]){return f}f=this.get(g);return this._escapedAttributes[g]=Z.escape(null==f?"":""+f)},has:function(f){return null!=this.get(f)},set:function(i,f,p){var o,n;Z.isObject(i)||null==i?(o=i,p=f):(o={},o[i]=f);p||(p={});if(!o){return this}o instanceof S&&(o=o.attributes);if(p.unset){for(n in o){o[n]=void 0}}if(!this._validate(o,p)){return !1}this.idAttribute in o&&(this.id=o[this.idAttribute]);var f=p.changes={},l=this.attributes,m=this._escapedAttributes,k=this._previousAttributes||{};for(n in o){i=o[n];if(!Z.isEqual(l[n],i)||p.unset&&Z.has(l,n)){delete m[n],(p.silent?this._silent:f)[n]=!0}p.unset?delete l[n]:l[n]=i;!Z.isEqual(k[n],i)||Z.has(l,n)!=Z.has(k,n)?(this.changed[n]=i,p.silent||(this._pending[n]=!0)):(delete this.changed[n],delete this._pending[n])}p.silent||this.change(p);return this},unset:function(g,f){(f||(f={})).unset=!0;return this.set(g,null,f)},clear:function(f){(f||(f={})).unset=!0;return this.set(Z.clone(this.attributes),f)},fetch:function(g){var g=g?Z.clone(g):{},f=this,i=g.success;g.success=function(m,l,k){if(!f.set(f.parse(m,k),g)){return !1}i&&i(f,m)};g.error=Y.wrapError(g.error,f,g);return(this.sync||Y.sync).call(this,"read",this,g)},save:function(g,f,o){var n,m;Z.isObject(g)||null==g?(n=g,o=f):(n={},n[g]=f);o=o?Z.clone(o):{};if(o.wait){if(!this._validate(n,o)){return !1}m=Z.clone(this.attributes)}g=Z.extend({},o,{silent:!0});if(n&&!this.set(n,o.wait?g:o)){return !1}var l=this,k=o.success;o.success=function(p,i,r){i=l.parse(p,r);if(o.wait){delete o.wait;i=Z.extend(n||{},i)}if(!l.set(i,o)){return false}k?k(l,p):l.trigger("sync",l,p,o)};o.error=Y.wrapError(o.error,l,o);f=this.isNew()?"create":"update";f=(this.sync||Y.sync).call(this,f,this,o);o.wait&&this.set(m,g);return f},destroy:function(g){var g=g?Z.clone(g):{},f=this,l=g.success,k=function(){f.trigger("destroy",f,f.collection,g)};if(this.isNew()){return k(),!1}g.success=function(m){g.wait&&k();l?l(f,m):f.trigger("sync",f,m,g)};g.error=Y.wrapError(g.error,f,g);var i=(this.sync||Y.sync).call(this,"delete",this,g);g.wait||k();return i},url:function(){var f=T(this,"urlRoot")||T(this.collection,"url")||J();return this.isNew()?f:f+("/"==f.charAt(f.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(f){return f},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(g){g||(g={});var f=this._changing;this._changing=!0;for(var k in this._silent){this._pending[k]=!0}var i=Z.extend({},g.changes,this._silent);this._silent={};for(k in i){this.trigger("change:"+k,this,this.get(k),g)}if(f){return this}for(;!Z.isEmpty(this._pending);){this._pending={};this.trigger("change",this,g);for(k in this.changed){!this._pending[k]&&!this._silent[k]&&delete this.changed[k]}this._previousAttributes=Z.clone(this.attributes)}this._changing=!1;return this},hasChanged:function(f){return !arguments.length?!Z.isEmpty(this.changed):Z.has(this.changed,f)},changedAttributes:function(g){if(!g){return this.hasChanged()?Z.clone(this.changed):!1}var f,l=!1,k=this._previousAttributes,i;for(i in g){if(!Z.isEqual(k[i],f=g[i])){(l||(l={}))[i]=f}}return l},previous:function(f){return !arguments.length||!this._previousAttributes?null:this._previousAttributes[f]},previousAttributes:function(){return Z.clone(this._previousAttributes)},isValid:function(){return !this.validate(this.attributes)},_validate:function(g,f){if(f.silent||!this.validate){return !0}var g=Z.extend({},this.attributes,g),i=this.validate(g,f);if(!i){return !0}f&&f.error?f.error(this,i,f):this.trigger("error",this,i,f);return !1}});var O=Y.Collection=function(g,f){f||(f={});f.model&&(this.model=f.model);f.comparator&&(this.comparator=f.comparator);this._reset();this.initialize.apply(this,arguments);g&&this.reset(g,{silent:!0,parse:f.parse})};Z.extend(O.prototype,W,{model:S,initialize:function(){},toJSON:function(f){return this.map(function(g){return g.toJSON(f)})},add:function(v,u){var t,s,r,p,o,n={},m={},f=[];u||(u={});v=Z.isArray(v)?v.slice():[v];t=0;for(s=v.length;t<s;t++){if(!(r=v[t]=this._prepareModel(v[t],u))){throw Error("Can't add an invalid model to a collection")}p=r.cid;o=r.id;n[p]||this._byCid[p]||null!=o&&(m[o]||this._byId[o])?f.push(t):n[p]=m[o]=r}for(t=f.length;t--;){v.splice(f[t],1)}t=0;for(s=v.length;t<s;t++){(r=v[t]).on("all",this._onModelEvent,this),this._byCid[r.cid]=r,null!=r.id&&(this._byId[r.id]=r)}this.length+=s;Q.apply(this.models,[null!=u.at?u.at:this.models.length,0].concat(v));this.comparator&&this.sort({silent:!0});if(u.silent){return this}t=0;for(s=this.models.length;t<s;t++){if(n[(r=this.models[t]).cid]){u.index=t,r.trigger("add",r,this,u)}}return this},remove:function(i,f){var n,m,l,k;f||(f={});i=Z.isArray(i)?i.slice():[i];n=0;for(m=i.length;n<m;n++){if(k=this.getByCid(i[n])||this.get(i[n])){delete this._byId[k.id],delete this._byCid[k.cid],l=this.indexOf(k),this.models.splice(l,1),this.length--,f.silent||(f.index=l,k.trigger("remove",k,this,f)),this._removeReference(k)}}return this},push:function(g,f){g=this._prepareModel(g,f);this.add(g,f);return g},pop:function(g){var f=this.at(this.length-1);this.remove(f,g);return f},unshift:function(g,f){g=this._prepareModel(g,f);this.add(g,Z.extend({at:0},f));return g},shift:function(g){var f=this.at(0);this.remove(f,g);return f},get:function(f){return null==f?void 0:this._byId[null!=f.id?f.id:f]},getByCid:function(f){return f&&this._byCid[f.cid||f]},at:function(f){return this.models[f]},where:function(f){return Z.isEmpty(f)?[]:this.filter(function(g){for(var i in f){if(f[i]!==g.get(i)){return !1}}return !0})},sort:function(g){g||(g={});if(!this.comparator){throw Error("Cannot sort a set without a comparator")}var f=Z.bind(this.comparator,this);1==this.comparator.length?this.models=this.sortBy(f):this.models.sort(f);g.silent||this.trigger("reset",this,g);return this},pluck:function(f){return Z.map(this.models,function(g){return g.get(f)})},reset:function(g,f){g||(g=[]);f||(f={});for(var k=0,i=this.models.length;k<i;k++){this._removeReference(this.models[k])}this._reset();this.add(g,Z.extend({silent:!0},f));f.silent||this.trigger("reset",this,f);return this},fetch:function(g){g=g?Z.clone(g):{};void 0===g.parse&&(g.parse=!0);var f=this,i=g.success;g.success=function(m,l,k){f[g.add?"add":"reset"](f.parse(m,k),g);i&&i(f,m)};g.error=Y.wrapError(g.error,f,g);return(this.sync||Y.sync).call(this,"read",this,g)},create:function(g,f){var k=this,f=f?Z.clone(f):{},g=this._prepareModel(g,f);if(!g){return !1}f.wait||k.add(g,f);var i=f.success;f.success=function(m,l){f.wait&&k.add(m,f);i?i(m,l):m.trigger("sync",g,l,f)};g.save(null,f);return g},parse:function(f){return f},chain:function(){return Z(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(g,f){f||(f={});g instanceof S?g.collection||(g.collection=this):(f.collection=this,g=new this.model(g,f),g._validate(g.attributes,f)||(g=!1));return g},_removeReference:function(f){this==f.collection&&delete f.collection;f.off("all",this._onModelEvent,this)},_onModelEvent:function(g,f,k,i){("add"==g||"remove"==g)&&k!=this||("destroy"==g&&this.remove(f,i),f&&g==="change:"+f.idAttribute&&(delete this._byId[f.previous(f.idAttribute)],this._byId[f.id]=f),this.trigger.apply(this,arguments))}});Z.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(f){O.prototype[f]=function(){return Z[f].apply(Z,[this.models].concat(Z.toArray(arguments)))}});var I=Y.Router=function(f){f||(f={});f.routes&&(this.routes=f.routes);this._bindRoutes();this.initialize.apply(this,arguments)},P=/:\w+/g,N=/\*\w+/g,M=/[-[\]{}()+?.,\\^$|#\s]/g;Z.extend(I.prototype,W,{initialize:function(){},route:function(g,f,i){Y.history||(Y.history=new U);Z.isRegExp(g)||(g=this._routeToRegExp(g));i||(i=this[f]);Y.history.route(g,Z.bind(function(k){k=this._extractParameters(g,k);i&&i.apply(this,k);this.trigger.apply(this,["route:"+f].concat(k));Y.history.trigger("route",this,f,k)},this));return this},navigate:function(g,f){Y.history.navigate(g,f)},_bindRoutes:function(){if(this.routes){var g=[],f;for(f in this.routes){g.unshift([f,this.routes[f]])}f=0;for(var i=g.length;f<i;f++){this.route(g[f][0],g[f][1],this[g[f][1]])}}},_routeToRegExp:function(f){f=f.replace(M,"\\$&").replace(P,"([^/]+)").replace(N,"(.*?)");return RegExp("^"+f+"$")},_extractParameters:function(g,f){return g.exec(f).slice(1)}});var U=Y.History=function(){this.handlers=[];Z.bindAll(this,"checkUrl")},L=/^[#\/]/,K=/msie [\w.]+/;U.started=!1;Z.extend(U.prototype,W,{interval:50,getHash:function(f){return(f=(f?f.location:window.location).href.match(/#(.*)$/))?f[1]:""},getFragment:function(g,f){if(null==g){if(this._hasPushState||f){var g=window.location.pathname,i=window.location.search;i&&(g+=i)}else{g=this.getHash()}}g.indexOf(this.options.root)||(g=g.substr(this.options.root.length));return g.replace(L,"")},start:function(g){if(U.started){throw Error("Backbone.history has already been started")}U.started=!0;this.options=Z.extend({},{root:"/"},this.options,g);this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var g=this.getFragment(),f=document.documentMode;if(f=K.exec(navigator.userAgent.toLowerCase())&&(!f||7>=f)){this.iframe=X('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(g)}this._hasPushState?X(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange" in window&&!f?X(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=g;g=window.location;f=g.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!f){return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0}this._wantsPushState&&this._hasPushState&&f&&g.hash&&(this.fragment=this.getHash().replace(L,""),window.history.replaceState({},document.title,g.protocol+"//"+g.host+this.options.root+this.fragment));if(!this.options.silent){return this.loadUrl()}},stop:function(){X(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);U.started=!1},route:function(g,f){this.handlers.unshift({route:g,callback:f})},checkUrl:function(){var f=this.getFragment();f==this.fragment&&this.iframe&&(f=this.getFragment(this.getHash(this.iframe)));if(f==this.fragment){return !1}this.iframe&&this.navigate(f);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(g){var f=this.fragment=this.getFragment(g);return Z.any(this.handlers,function(i){if(i.route.test(f)){return i.callback(f),!0}})},navigate:function(g,f){if(!U.started){return !1}if(!f||!0===f){f={trigger:f}}var i=(g||"").replace(L,"");this.fragment!=i&&(this._hasPushState?(0!=i.indexOf(this.options.root)&&(i=this.options.root+i),this.fragment=i,window.history[f.replace?"replaceState":"pushState"]({},document.title,i)):this._wantsHashChange?(this.fragment=i,this._updateHash(window.location,i,f.replace),this.iframe&&i!=this.getFragment(this.getHash(this.iframe))&&(f.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,i,f.replace))):window.location.assign(this.options.root+g),f.trigger&&this.loadUrl(g))},_updateHash:function(g,f,i){i?g.replace(g.toString().replace(/(javascript:|#).*$/,"")+"#"+f):g.hash=f}});var j=Y.View=function(f){this.cid=Z.uniqueId("view");this._configure(f||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},q=/^(\S+)\s*(.*)$/,e="model,collection,el,id,attributes,className,tagName".split(",");Z.extend(j.prototype,W,{tagName:"div",$:function(f){return this.$el.find(f)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(g,f,i){g=document.createElement(g);f&&X(g).attr(f);i&&X(g).html(i);return g},setElement:function(g,f){this.$el&&this.undelegateEvents();this.$el=g instanceof X?g:X(g);this.el=this.$el[0];!1!==f&&this.delegateEvents();return this},delegateEvents:function(g){if(g||(g=T(this,"events"))){this.undelegateEvents();for(var f in g){var l=g[f];Z.isFunction(l)||(l=this[g[f]]);if(!l){throw Error('Method "'+g[f]+'" does not exist')}var k=f.match(q),i=k[1],k=k[2],l=Z.bind(l,this),i=i+(".delegateEvents"+this.cid);""===k?this.$el.bind(i,l):this.$el.delegate(k,i,l)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(g){this.options&&(g=Z.extend({},this.options,g));for(var f=0,k=e.length;f<k;f++){var i=e[f];g[i]&&(this[i]=g[i])}this.options=g},_ensureElement:function(){if(this.el){this.setElement(this.el,!1)}else{var f=T(this,"attributes")||{};this.id&&(f.id=this.id);this.className&&(f["class"]=this.className);this.setElement(this.make(this.tagName,f),!1)}}});S.extend=O.extend=I.extend=j.extend=function(g,f){var i=h(this,g,f);i.extend=this.extend;return i};var d={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};Y.sync=function(g,f,l){var k=d[g];l||(l={});var i={type:k,dataType:"json"};l.url||(i.url=T(f,"url")||J());if(!l.data&&f&&("create"==g||"update"==g)){i.contentType="application/json",i.data=JSON.stringify(f.toJSON())}Y.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(Y.emulateHTTP&&("PUT"===k||"DELETE"===k)){Y.emulateJSON&&(i.data._method=k),i.type="POST",i.beforeSend=function(m){m.setRequestHeader("X-HTTP-Method-Override",k)}}"GET"!==i.type&&!Y.emulateJSON&&(i.processData=!1);return X.ajax(Z.extend(i,l))};Y.wrapError=function(g,f,i){return function(l,k){k=l===f?k:l;g?g(f,k,i):f.trigger("error",f,k,i)}};var c=function(){},h=function(g,f,k){var i;i=f&&f.hasOwnProperty("constructor")?f.constructor:function(){g.apply(this,arguments)};Z.extend(i,g);c.prototype=g.prototype;i.prototype=new c;f&&Z.extend(i.prototype,f);k&&Z.extend(i,k);i.prototype.constructor=i;i.__super__=g.prototype;return i},T=function(g,f){return !g||!g[f]?null:Z.isFunction(g[f])?g[f]():g[f]},J=function(){throw Error('A "url" property or function must be specified')}}).call(this);